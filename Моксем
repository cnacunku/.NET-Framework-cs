Лабораторная работа № 2
«SQL-запросы выбора данных»
Цель работы
Изучение теоретических основ и получение практических навыков в области
выбора и фильтрации данных.
Краткие теоретические сведения
1. SQL-запрос SELECT
Оператор SELECT образует основу каждого вопроса, который вы задаете базе
данных. Когда создается и выполняется оператор SELECT, то вы “обращаетесь с
запросом к базе данных” (надеемся, что все читатели единодушны в этом вопросе).
Фактически многие программы СУРБД позволяют сохранить оператор SELECT как
запрос, представление или хранимую процедуру. Когда кто-то собирается обратиться с запросом к базе данных, вы должны понимать, что предполагается выполнить некий оператор SQL. В зависимости от программы СУРБД операторы SELECT могут выполняться по-разному: непосредственно из окна командной строки,
из таблицы интерактивного запроса с использованием примера (Query By Example,
QBE) или из блока программного кода. Независимо от того, каким образом вы решили определить и выполнить его, синтаксис оператора SELECT всегда один и тот
же.
2. Структура SQL-запроса SELECT
Команда SELECT - наиболее часто употребляемая команда из всех восьми.
Она используется для выборки данных из базы данных. Её синтаксис:
SELECT [Предикат] Поля FROM Таблицы [IN БазаДанных] [WHERE ...]
[GROUP BY ...] [HAVING ...] [ORDER BY ...];
Необязательные аргументы заключены в [].
Предикат - одно из четырёх слов ALL, DISTINCT, DISTINCTROW, TOP. Если
предикат не указан, то устанавливается ALL. Предикат ALL позволяет отобрать все
записи. При использовании предиката DISTINCT, записи, которые содержат повторяющиеся значения в выбранных в запросе полях, исключаются. Предикат
DISTINCTROW исключает из выборки записи, если повторяется вся запись, а не
одно из полей. Предикат TOP позволяет отобрать определённое количество записей.
Минимальный синтаксис запроса на выборку выглядит так:
SELECT поле FROM Таблица.
Поместите звездочку сразу после условия SELECT, когда нужно определить
все столбцы из исходной таблицы в условии FROM. Например, так выглядит
предшествующий оператор SELECT при использовании сокращения:
14
SELECT * FROM Subjects
3. Исключение дубликатов строк (DISTINCT)
При работе с операторами SELECT вы неизбежно столкнетесь в наборах результатов с повторяющимися строками. Поэтому используйте ключевое слово
DISTINCT в своем операторе SELECT, и набор результатов не будет содержать повторяющихся строк:
SELECT DISTINCT City FROM Bowlers
Ключевое слово DISTINCT также можно использовать для составных столбцов. Изменим предыдущий пример, запросив из таблицы Bowlers как штат, так и
город. Наш новый оператор SELECT будет выглядеть так:
SELECT DISTINCT State, City FROM Bowlers
Этот оператор SELECT возвращает набор результатов, который содержит уникальные записи.
4. Сортировка информации (ORDER BY)
Операцию SELECT можно разделить на три более мелкие операции: оператор
SELECT, выражение SELECT и запрос SELECT. Можно объединять эти операции
различными способами, чтобы ответить на сложные запросы. Также необходимо
объединять эти операции для сортировки строк в наборе результатов.
По определению строки набора результатов, возвращенные оператором
SELECT, не упорядочены. Последовательность, в которой они появляются, основывается на их физическом расположении в таблице.
Условие ORDER BY запроса SELECT позволяет определить последовательность строк в окончательном наборе результатов. Из последующих глав вы узнаете,
что для ответа на очень сложные вопросы можно вложить оператор SELECT в другой оператор SELECT или в выражение SELECT. Однако запрос SELECT невозможно вложить в какой-либо другой уровень.
Условие ORDER BY позволяет упорядочить набор результатов указанного
оператора SELECT по одному или нескольким столбцам, а также содержит опцию
упорядочивания по возрастанию или убыванию для каждого столбца. В условии
ORDER BY можно использовать только те столбцы, которые в настоящий момент
перечислены в условии SELECT. Хотя это требование указано в стандарте SQL,
некоторые реализации его полностью игнорируют (однако во всех примерах, используемых в данной книге, это требование нами соблюдается). Когда в условии
ORDER BY используются два или более столбцов, каждый столбец отделяется запятой. Как только сортировка завершается, запрос SELECT возвращает окончательный набор:
15
SELECT Category FROM Classes ORDER BY Category
В данном примере можно предположить, что категория будет использоваться
для сортировки, поскольку это единственный столбец, указанный в запросе. Также
можно предположить, что сортировка должна производиться в порядке возрастания, потому что в запросе не указано противоположное. Это безопасное предположение.
В следующем запросе столбец, необходимый для сортировки, определяется
более явно:
SELECT VendName, VendZipCode
FROM Vendors
ORDER BY VendZipCode
В соответствие со стандартом SQL, если не определен порядок сортировки, то
автоматически предполагается сортировка в порядке возрастания. Однако, если вы
хотите все указать явно, вставьте ASC (от Ascending — по возрастанию) после Category в условии ORDER BY.
SELECT EmpLastName, EmpFirstName, EmpPhoneNumber, EmployeelD FROM
Employees ORDER BY EmpLastName DESC, EmpFirstName ASC
Если нужно отобразить набор результатов в обратном порядке, вставьте ключевое слово DESC (от Descending — по убыванию) после соответствующего столбца в условии ORDER BY. Посмотрите, как изменяется оператор SELECT из предыдущего примера, когда требуется представить информацию, отсортированную по
почтовому индексу в порядке убывания:
SELECT VendName, VendZipCode FROM Vendors
ORDER BY VendZipCode DESC
Пример совместного использования сортировки по возрастанию и по убыванию:
SELECT TourneyDate, TourneyLocation FROM Tournaments ORDER BY TourneyDate DESC, TourneyLocation ASC
5. Фильтрация данных
5.1. Условие WHERE
Условие WHERE в операторе SELECT используется для фильтрации данных,
которые оператор извлекает из таблицы. WHERE содержит условие поиска, применяемое оператором в качестве фильтра. Именно это условие поиска обеспечивает
механизм, необходимый для выбора только требуемых строк или для удаления ненужных. СУБД применяет это условие поиска к каждой строке в логической таблице, определенной условием FROM.
16
Условие поиска содержит один или более предикатов, каждый из которых является выражением, которое тестирует одно или несколько типизированных выражений и возвращает в ответе True, False или Unknown. Несколько предикатов можно объединять в условие поиска, используя булевы операторы AND или OR. Когда
условие поиска оказывается равным True для конкретной строки, эта строка будет
присутствовать в окончательном наборе результата. Когда условие поиска содержит только один предикат, термины “условие поиска” и “предикат” являются синонимами.
Типизированное выражение может содержать имена столбца, значения литерала, функции или другие типизированные выражения. При построении предиката
обычно включается по крайней мере одно типизированное выражение, которое
указывает столбец из таблиц, определенных в условии FROM.
Самый простой и, возможно, наиболее распространенный предикат сравнивает
одно типизированное выражение (столбец) с другим (литерал). Например, если
нужны только те строки из таблицы Customers, в которых значение столбца фамилии клиента — “Smith”, то записывается предикат, который сравнивает столбец
фамилии со значением литерала “Smith”.
SELECT CustLastName FROM Customers
WHERE CustLastName = ‘Smith’
Предикат в условии WHERE эквивалентен обращению с вопросом к каждой
строке в таблице Customers: “Совпадает ли фамилия клиента со ’’Smith"?" Когда
ответ положительный (True) для произвольной строки в таблице Customers, эта
строка появляется в наборе результатов.
5.2. Базовые предикаты
Стандарт SQL определяет пять базовых предикатов: сравнение, BETWEEN,
IN, LIKE и IS NULL.
Таблица 2
Базовые предикаты
Сравнение Для сравнения одного типизированного выражения с другим используется один из шести операторов сравнения: ( = , о, <, >, < = ,
>=).
Диапазон Предикат BETWEEN позволяет тестировать, попадает ли указанное
типизированное выражение в указанный диапазон значений. Диапазон определяется с помощью двух
типизированных выражений, разделенных ключевым словом AND.
17
Принадлежность Используя предикат IN, можно
проверить, совпадает ли значение
указанного типизированного выражения с элементом заданного списка значений.
Поиск по шаблону
Предикат LIKE позволяет проверить, совпадает ли выражение типа
“символьная строка” с указанным
образцом символьной строки.
Null Используйте предикат IS NULL для
определения, равно ли типизированное выражение Null.
Пример сравнения:
SELECT ProductName
FROM Products
WHERE RetailPrice <= 50
Примеры диапазона:
SELECT FirstName, LastName FROM Staff WHERE DateHired BETWEEN
'2015-01-01’ AND '2015-02-01'
SELECT StudLastName, StudFirstName, StudPhoneNumber FROM Students
WHERE StudLastName BETWEEN ‘b’ AND ‘bz’
Примеры принадлежности множеству:
SELECT TourneyLocation FROM Tournaments WHERE TourneyDate IN (‘2014-
06-05’, ‘2014-07-03', '2014-08-07’)
SELECT EntStageName FROM Entertainers WHERE EntCity IN (‘Seattle1, ‘Redmond’, ‘Bothell’)
5.3. Совпадение по шаблону (LIKE)
Условие совпадения с образцом является полезным, когда нужно найти значения, подобные указанной строке-образцу, или когда только неполная часть информации используется как критерий поиска.
В этом условии берется значение типизированного выражения и используется
предикат LIKE для проверки, совпадает ли это значение с заданным образцом
строки. Образец строки может состоять из любой логической комбинации обычных
строк символов и двух специальных групповых символов: процента «%» и подчеркивания «_». Символ процента представляет ни одного или несколько произвольных обычных символов, а символ подчеркивания представляет собой единствен-
18
ный произвольный обычный символ. Способ определения образца строки устанавливает, какие значения извлекаются из типизированного выражения:
SELECT CustLastName, CustFirstName FROM Customers
WHERE CustLastName LIKE 'Mar%'
SELECT VendName FROM Vendors
WHERE VendStreetAddress LIKE ‘%Forest%’
5.4. Значение Null
Null не представляет собой нули, символьную строку из одного или нескольких пробелов или символьную строку нулевой длины (т. е. не содержащую в себе
символов), потому что каждый из этих элементов может быть значащим во множестве различных ситуаций. Null представляет собой пропущенное или неизвестное
значение. Пример использования NULL:
SELECT CustFirstName FROM Customers WHERE CustCounty IS NULL
5.5. Исключение строк (NOT)
Исключить строки из набора результатов можно с помощью оператора NOT.
При включении оператора NOT оператор SELECT проигнорирует все строки, которые удовлетворяют условию, указанному любым из этих предикатов. В наборе результатов будут присутствовать те строки, которые не удовлетворяют условию.
Приведенные далее примеры показывают, как можно использовать NOT в качестве части условия поиска:
SELECT OrderlD, OrderDate FROM Orders WHERE OrderDate NOT BETWEEN
‘2014-07-01' AND ‘2014-07-31’
SELECT StaffID, Title FROM Faculty
WHERE Title NOT IN ('Professor', 'Associate Professor’)
Технология выполнения лабораторной работы
1. Запустите MySQL сервер.
Чтобы создать запрос вам нужно запустите Microsoft SQL Server Management
Studio, далее, просто нажать кнопку New Querty (Новый запрос) на панели инструментов (рис. 1).
2. В окне SQL запроса в верхнем полу пишется текст запроса, а в нижнем - выводится таблица результата выполнения запроса (рис. 2). Чтобы запустить запрос
на выполнение нужно нажать кнопку Execute на панели инструментов.
3. Выполните запросы своего варианта для построения базы данных и манипуляции данных.
Задание на лабораторную работу
19
1. Запустить SQL сервер.
2. Сформировать серию различных SQL-запросов выбора на основе своего варианта базы данных, с использованием:
- стандартной структуры запроса SELECT;
- исключения дубликатов DISTINCT;
- сортировки информации с помощью ORDER BY;
- условия WHERE;
- базовых предикатов фильтрации данных;
- работу со значением NULL;
- исключения строк с помощью NOT;
- инструкции AND / OR;
- инструкции LIKE / ESCAPE.
3. Показать результаты работы преподавателю.
4. Подготовить отчет по лабораторной работе.
